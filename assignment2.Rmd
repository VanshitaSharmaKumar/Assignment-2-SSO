---
title: "Assignment 2 Group 26"
author: 
  - "Vanshita Sharma Kumar"
  - "Lucian Truşcă"
  - "Xander Poortvliet"
date: "`r Sys.Date()`"
output:
  pdf_document:
    latex_engine: xelatex
fig_caption: true
header-includes:
  - \usepackage{float}
---

```{r setup, include=FALSE}
library(knitr)
library(modelsummary)
library(ggplot2)
library(png)
knitr::opts_chunk$set(echo = TRUE)
```

# Excercise 2.1
### 2.1a
We first will start with the full multi-regression model
```{r, echo=FALSE}
sat = read.delim("sat.txt", header=TRUE, sep = "", stringsAsFactors = FALSE)
```
```{r 2.1 a}
model_full = lm(total ~ expend + ratio + salary + takers, data=sat)
```
```{r, echo=FALSE}
cat("The AIC score for the full model =", (AIC(model_full)))
```
Step Up method: With the forward selection we will first start with no predictors and add variables one by one based on the lowest AIC
```{r}
model_StepUp = lm(total ~ expend + takers, data=sat)
```
```{r, echo=FALSE}
cat("The AIC score for the step-up method  =", (AIC(model_StepUp)))
```
Step-down Method: we start from the full model and iteratively remove variables that worsen AIC the least.
```{r}
model_StepDown <- lm(total ~ expend + takers, data=sat)
```
```{r, echo=FALSE}
cat("The AIC score for the step-down method  =", (AIC(model_StepDown)))
```
Model interpretation: SAT performance is best explained by school spending and participation rate. Other variables (ratio, salary) don’t significantly improve model fit. 

### 2.1b
```{r}
sat$takers2 = sat$takers^2
## 2) Stepwise model selection (AIC)
# forward (start from intercept)
m0    = lm(total ~ 1, data = sat)
scope = ~ expend + ratio + salary + takers + takers2
m_fwd = step(m0, scope = list(lower = ~1, upper = scope),
              direction = "forward", trace = 0)
```
Where the result for the AIC is 473.9 (rounded up from 473.85). 
```{r, echo=FALSE}
# backward (start from full)
m_full = lm(total ~ expend + ratio + salary + takers + takers2, data = sat)
m_bwd  = step(m_full, direction = "backward", trace = 0)
## 3) Is takers^2 useful? Compare with/without the square
m_nosq = lm(total ~ expend + takers, data = sat)          # without takers^2
m_sq   = lm(formula(m_fwd), data = sat)
result = AIC(m_nosq); AIC(m_sq) 
cat("The AICS without takers2 is: ", result)
anova_result = anova(m_nosq, m_sq)
print(anova_result) 
```
In a nested-model ANOVA comparing \(M_1:\ \text{total} \sim \text{expend} + \text{takers}\) to \(M_2:\ \text{total} \sim \text{expend} + \text{takers} + \text{takers}^2\), adding the quadratic term reduces the residual sum of squares from \(49{,}520\) to \(31{,}298\), a drop of \(18{,}222\) with one additional parameter (\(\text{df} = 1\)), yielding \(F(1,46)=26.783\) and \(p=4.872\times 10^{-6}\). This highly significant improvement leads us to reject \(H_0:\ \beta_{\text{takers}^2}=0\) and conclude that \(\textbf{takers}^2\) is a useful predictor: it captures curvature in the relationship between SAT scores and participation that the linear-only specification misses.

### 2.1c
Comparing the reduced model \(M_1\) to the expanded model \(M_2\), the ANOVA shows a large and statistically significant drop in residual sum of squares as seen previously, where this drop implies the rejection of \(H_0:\beta_{\text{takers}^2}=0\) and confirming that the quadratic term is informative; this statistical improvement is mirrored by information criteria, with AIC falling from \(\approx 492.8\) for \(M_1\) to \(\approx 471.9\) for \(M_2\), indicating that the model including \(\text{takers}^2\) provides a substantially better fit despite its extra parameter.

### 2.1d
QUESTION D


# Excercise 2.2
### 2.2a
```{r, echo=FALSE}
data = read.table("treeVolume.txt", header = TRUE)
```
```{r}
data$type <- factor(data$type)
model_a = lm(volume ~ type, data = data)

predict(model_a, newdata = data.frame(type = c("beech", "oak")))

summary(model_a)
anova(model_a)
```
An ANOVA comparing mean wood volume between "beech" and "oak" trees shows no statistically significant difference (F = 1.90, p = 0.17). This indicates that, based only on tree type, there is no evidence that oak trees are more voluminous than beech tres. The estimated mean volumes were approximately {beech=30.17, oak = 35.25}. While it appears oaks may be slightly larger on average, this difference is not significant at the 5% level.

### 2.2b
data = read.table("treeVolume.txt", header = TRUE)
data$type <- factor(data$type)
model_a = lm(volume ~ type, data = data)

summary(model_a)
anova(model_a)
```
There is no statistically significant difference in average volume between Oak and Beech trees in this sample.
That means, based on these 59 trees, we cannot conclude that Oaks are more voluminous than Beeches.
A one-way ANOVA comparing mean wood volume between Beech and Oak trees showed no significant difference (F = 1.90, p = 0.17).
The estimated mean volumes were ≈ [insert your group means]; hence, although Oaks appear slightly larger on average, this difference is not statistically significant at the 5 % level.

b) (1.1) Investigate whether the tree type influences the volume, now including diameter
and height (but no interactions) as predictors into the analysis, which results in an
ANCOVA analysis. How does tree type influence volume? What are the estimated
volumes for the two tree types with average diameter and height? (Hint: use function
predict.) How does diameter influence volume? Graphically (or propose and perform
a relevant test) investigate whether this dependence is similar for both tree types.

```{r}
data = read.table("treeVolume.txt", header=TRUE)
data$type = factor(data$type)

# fitting an ANCOVA model, now including diameter and height
model_b <- lm(volume ~ diameter + height + type, data = data)

str(data)
summary(data)

summary(model_b)
anova(model_b)          

#mean values from data (for estimating volume later)
mean_diam = mean(data$diameter)
mean_height = mean(data$height)
```
An ANCOVA including diameter and height as covariates showed that both diameter (p << 0.001) and height (p << 0.001) significantly affect tree volume. However, tree type was not significant (p = 0.143), indicating that, once diameter and height are accounted for, Beech and Oak trees have similar expected volumes.

```{r}
#Now we estimate/predict volumes for these avg values
newdata = data.frame(
  type = c("beech", "oak"),
  diameter = mean_diam,
  height = mean_height
)

predicted_vol = predict(model_b, newdata = newdata, interval = "confidence")
predicted_vol
```
Using our fitted ANCOVA model, predicted mean volumes for "beech" and "oak" at average diameter and height are nearly identical, with overlapping confidence intervals. This confirms that tree type does not have a statistically significant influence on volume when tree size is controlled for.


```{r}
library(ggplot2)

ggplot(data, aes(x = diameter, y = volume, color = type)) +
  geom_point() +
  geom_smooth(method = "lm", formula = y ~ x, se = FALSE) +
  theme_minimal()
```
The scatterplot shows that volume increases linearly with diameter for both tree types, and the regression lines are nearly parallel. 


```{r}
model_interaction <- lm(volume ~ type * diameter + height, data = data)
anova(model_b, model_interaction)
```
When we added an interaction between tree type and diameter, the model didn’t improve (F = 0.52, p = 0.474). This means the way volume changes with diameter is about the same for both beech and oak, so the ANCOVA assumption of parallel slopes is reasonable.

### 2.2c
The volume of a cylinder is given by \(V = \pi r^{2} H\), where \(r\) is the radius of the circular base, \(H\) is the height, and \(\pi\) is the mathematical constant (approximately \(3.14159\)).
```{r, echo=FALSE}
trees = read.table("treeVolume.txt", header = TRUE, sep = "\t")
```
```{r 2.2c}
trees$type = factor(trees$type)
trees$calc_vol = pi*((trees$diameter/2)^2)*trees$height
model_c = lm(volume ~ calc_vol + type, data = trees)
summary(model_c)
anova(model_c)
```
As p <= 0.05, this yields a better result.

# Excercise 2.3
To solve the problem of the optimal product mix with excel. We choose the number of servings of each food to minimize total cost while meeting minimum nutrient requirements.
It is important to note that for all questions, the options menu has the same configuration as in the image below. 
```{r, fig.cap=c('Options Menu'), out.width='50%', fig.show='hold', fig.align='center', fig.pos='H', echo=FALSE}
knitr::include_graphics(c('imgs/options_menu.png'))
```

## Notation
- Foods \(F=\{\text{carrots},\text{potatoes},\text{bread},\text{cheddar},\text{pb}\}\).
- Parameters per serving \(f\in F\):
  - price \(c_f\),
  - calories \(a^{\text{cal}}_f\),
  - fat \(a^{\text{fat}}_f\),
  - protein \(a^{\text{prot}}_f\),
  - carbs \(a^{\text{carb}}_f\).
- Minimum requirements: \((b_{\text{cal}}, b_{\text{fat}}, b_{\text{prot}}, b_{\text{carb}})=(2000,50,100,250)\).
- Decision variables: \(x_f \ge 0\) = servings of food \(f\).

### 2.3a
The solution uses continuous servings, so constraints can be met exactly. We can visualise our excel solver.
\[
\begin{aligned}
\min_{x\ge0}\quad 
  & \sum_{f\in F} c_f\,x_f \\
\text{s.t.}\quad
  & \sum_{f\in F} a^{\text{cal}}_f x_f \;\;\ge\; b_{\text{cal}},\\
  & \sum_{f\in F} a^{\text{fat}}_f x_f \;\;\ge\; b_{\text{fat}},\\
  & \sum_{f\in F} a^{\text{prot}}_f x_f \;\;\ge\; b_{\text{prot}},\\
  & \sum_{f\in F} a^{\text{carb}}_f x_f \;\;\ge\; b_{\text{carb}}.
\end{aligned}
\]
```{r, fig.cap=c('2.3a Excel Solver'), out.width='60%', fig.show='hold', fig.align='center', fig.pos='H', echo=FALSE}
knitr::include_graphics(c('imgs/2_3a.png'))
```
According to the optimal solution for the linear optimization problem, the cheapest feasible diet is a two-food combination of 7.71 servings of baked potatoes and 9.28 servings of peanut butter, costing approximately $2.32 per day. In this optimal solution, the protein and carbohydrate requirements are exactly met, with an excess (slack) in calories and fat, meaning these nutrients are well above their minimum thresholds. 

### 2.3b
Let peanut butter be split into two variables:
\(x_{\text{pb}}^{(1)}\) = the **first** (cheap) PB servings, and
\(x_{\text{pb}}^{(2)}\) = any **additional** PB servings.
Prices: \(c_{\text{pb}}^{(1)}=0.15\), \(c_{\text{pb}}^{(2)}=0.25\).
Cap: \(0 \le x_{\text{pb}}^{(1)} \le 5\).

All nutrients per serving are identical for both PB tiers.
```{r, fig.cap=c('2.3b Excel Solver'), out.width='60%', fig.show='hold', fig.align='center', fig.pos='H', echo=FALSE}
knitr::include_graphics(c('imgs/2_3b.png'))
```
*Interpretation.* This stays linear by replacing PB with two variables: buy up to 5 cheap units, then any extra at the higher price.
In the optimum, the model purchases exactly the 5 cheap PB units and substitutes the rest with the next-best cheap source (potatoes), increasing total cost to 16.62 vs. (a).

### 2.3c
Same as (a), but restrict servings to integers:
\[
x_f \in \mathbb{Z}_{\ge 0}\quad \text{for all } f\in F.
\]
```{r, fig.cap=c('2.3c Excel Solver'), out.width='50%', fig.show='hold', fig.align='center', fig.pos='H', echo=FALSE}
knitr::include_graphics(c('imgs/2_3c.png'))
```
*Interpretation.* Integrality removes the ability to hit thresholds exactly, so the solution “rounds up” and typically costs more than the fractional LP.

# Excercise 2.4

### 2.4a

This model minimizes total shipping cost from three sources (S1–S3) to four destinations (D1–D4). Each source has a *supply limit* and each destination has a *demand requirement*. The Solver chooses shipments \(x_{ij}\) (from source \(i\) to destination \(j\)) so that **total cost is minimal** while all supply and demand constraints are met.

**Model.**
\[
\begin{aligned}
\min_{x} \quad & \sum_{i\in S}\sum_{j\in D} c_{ij}\,x_{ij} \\[2pt]
\text{s.t.}\quad
& \sum_{j\in D} x_{ij} \;\le\; a_i && \forall i\in S \quad \text{(supply)}\\
& \sum_{i\in S} x_{ij} \;\ge\; b_j && \forall j\in D \quad \text{(demand)}\\
& x_{ij} \;\ge\; 0 && \forall (i,j)\in S\times D~.
\end{aligned}
\]

```{r, fig.cap=c('2.4a Excel Solver'), out.width='60%', fig.show='hold', fig.align='center', fig.pos='H', echo=FALSE}
knitr::include_graphics(c('imgs/2_4a.png'))
```
The optimal flows is the following, S1 ships 5 to D2 and 15 to D4; S2 ships 10 to D3 and 15 to D2; S3 ships 10 to D1 and 5 to D4. With a minimum total transportation cost of **\$460**.
*Interpretation.* The solution uses the cheapest lanes as much as possible (e.g., S2\(\rightarrow\)D2, S3\(\rightarrow\)D1) and avoids expensive ones (e.g., S1\(\rightarrow\)D3). Total cost **\$460** is the most economical plan that exactly meets demand without exceeding supply.

### 2.4b 
Question 2.4b extends the previous question by adding a **fixed cost of 100** each time a route \((i,j)\) is used. Binary variables \(y_{ij}\in\{0,1\}\) indicate whether a route is opened. The objective now minimizes **transport cost + fixed activation cost**.
```{r, fig.cap=c('2.4b Excel Solver'), out.width='60%', fig.show='hold', fig.align='center', fig.pos='H', echo=FALSE}
knitr::include_graphics(c('imgs/2_4b.png'))
```
The optimal plan opens only cost-effective routes (those with \(y_{ij}=1\)) and sends the required flows on them. The minimum total cost (including fixed charges) will be **\$1060**.
*Interpretation.* With activation costs, the model prefers **fewer routes** carrying larger volumes to avoid paying many fixed fees. This raises total cost from **\$460** to **\$1060**, but yields a more consolidated network.
